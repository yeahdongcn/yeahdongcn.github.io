{"version":3,"sources":["webpack:///./pages/auth/verify.vue","webpack:///./pages/auth/verify.vue?a610","webpack:///pages/auth/verify.vue","webpack:///./pages/auth/verify.vue?de09"],"names":["component","reply","err","code","window","opener","onAuthTest","setTimeout","close","layout","data","mounted","this","$route","query","render","_h","$createElement","_c","_self","staticClass","_v","staticRenderFns"],"mappings":"4FAAA,sIAOIA,UAAY,YACd,UACA,IACA,KACA,EACA,KACA,KACA,MAIa,UAAAA,U,2CClBf,0HAA6S,YAAG,G,oKCChT,YACA,QACA,iDAEA,SAASC,EAAMC,EAAKC,MAClB,IACEC,OAAOC,OAAOD,OAAOE,WAAWJ,EAAKC,MACrCI,YAAW,WACTH,OAAOI,UACb,KACA,SACIJ,OAAOI,S,MAIX,CACEC,OAAQ,kBAER,MAHF,YAGA,qMACA,4BACA,8BACA,8BACA,oBAJA,qDAUA,KAVA,kCAWA,+BACA,UACA,8BACA,oCAdA,QAiBA,OANA,EAXA,QAiBA,SACA,0BAEA,MAEA,wCAtBA,+CA2BEC,KA9BF,WAmCI,MAAO,CAAX,SAJA,uCAEA,oBAKEC,QAtCF,WAuCI,GAAI,KAAR,QACM,IACEV,EAAM,KAAMW,KAAKC,OAAOC,MAAM,EAAtC,cACA,SACQV,OAAOI,YAEf,OACA,cADA,EACA,SADA,EACA,MAEM,GAAI,OAAV,0DACQ,IAAR,wBAEY,EAAZ,cACc,OAAd,yBACYP,EAAM,KAAM,MAEZA,EAAM,CAAlB,qB,mHCvEA,IAAIc,EAAS,WAAa,IAAiBC,EAATJ,KAAgBK,eAAmBC,EAAnCN,KAA0CO,MAAMD,IAAIF,EAAG,OAAOE,EAAG,OAAO,CAACA,EAAG,KAAK,CAACE,YAAY,qBAAqB,CAAnHR,KAAgI,QAAEM,EAAG,OAAO,CAA5IN,KAAiJS,GAAG,4BAA4BH,EAAG,OAAO,CAA1LN,KAA+LS,GAAG,oCAChOC,EAAkB","file":"pages/auth/verify.f457ff781b8b9cac7664.js","sourcesContent":["import { render, staticRenderFns } from \"./verify.vue?vue&type=template&id=c13495d6&\"\nimport script from \"./verify.vue?vue&type=script&lang=js&\"\nexport * from \"./verify.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--5-0!../../node_modules/thread-loader/dist/cjs.js??ref--5-1!../../node_modules/babel-loader/lib/index.js??ref--5-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./verify.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--5-0!../../node_modules/thread-loader/dist/cjs.js??ref--5-1!../../node_modules/babel-loader/lib/index.js??ref--5-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./verify.vue?vue&type=script&lang=js&\"","<script>\nimport { GITHUB_CODE, GITHUB_NONCE, BACK_TO } from '@/config/query-params';\nimport { get } from '@/utils/object';\nconst samlProviders = ['ping', 'adfs', 'keycloak', 'okta', 'shibboleth'];\n\nfunction reply(err, code) {\n  try {\n    window.opener.window.onAuthTest(err, code);\n    setTimeout(() => {\n      window.close();\n    }, 250);\n  } catch (e) {\n    window.close();\n  }\n}\n\nexport default {\n  layout: 'unauthenticated',\n\n  async fetch({ store, route, redirect }) {\n    const code = route.query[GITHUB_CODE];\n    const state = route.query[GITHUB_NONCE] || '';\n    const isGoogle = state.includes('-googleoauth');\n    const isTesting = state.includes('-test');\n\n    if (isTesting) {\n      return;\n    }\n\n    if (code) {\n      const res = await store.dispatch('auth/verifyOAuth', {\n        code,\n        nonce:    route.query[GITHUB_NONCE],\n        provider: isGoogle ? 'googleoauth' : 'github'\n      });\n\n      if ( res._status === 200) {\n        const backTo = route.query[BACK_TO] || '/';\n\n        redirect(backTo);\n      } else {\n        redirect(`/auth/login?err=${ escape(res) }`);\n      }\n    }\n  },\n\n  data() {\n    const state = this.$route.query[GITHUB_NONCE] || '';\n\n    const testing = state.includes('-test');\n\n    return { testing };\n  },\n\n  mounted() {\n    if ( this.testing ) {\n      try {\n        reply(null, this.$route.query[GITHUB_CODE] );\n      } catch (e) {\n        window.close();\n      }\n    } else {\n      const { params, query } = this.$route;\n\n      if ( window.opener && !get(params, 'login') && !get(params, 'errorCode') ) {\n        const configQuery = get(query, 'config');\n\n        if ( samlProviders.includes(configQuery) ) {\n          if ( window.opener.window.onAuthTest ) {\n            reply(null, null);\n          } else {\n            reply({ err: 'failure' });\n          }\n        }\n      }\n    }\n  },\n};\n</script>\n\n<template>\n  <main>\n    <h1 class=\"text-center mt-50\">\n      <span v-if=\"testing\">\n        Testing&hellip;\n      </span>\n      <span v-else>\n        Logging In&hellip;\n      </span>\n    </h1>\n  </main>\n</template>\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('main',[_c('h1',{staticClass:\"text-center mt-50\"},[(_vm.testing)?_c('span',[_vm._v(\"\\n      Testing…\\n    \")]):_c('span',[_vm._v(\"\\n      Logging In…\\n    \")])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}